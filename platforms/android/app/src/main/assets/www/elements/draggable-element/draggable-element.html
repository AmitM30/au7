
<!--
An element providing draggable functionality

Example:
    <draggable-element></draggable-element>
@demo
-->
<dom-module id="draggable-element">
  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }
  </style>

  <template>
    <div draggable="true" on-dragstart="_handleDrag" on-drag="_drag" on-dragend="_dragEnd" on-touchmove="_handleTouch">
      <content></content>
    </div>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'draggable-element',

    properties: {

    },

    _drag: function (e) {
      var el = e.target.children[0];
      /* if(e.clientY !== 0 && e.clientX !== 0) {
        el.style.top = (e.clientY - el.clientHeight) + 'px';
        el.style.left = (e.clientX - el.clientWidth) + 'px';
        el.style.bottom = 'auto';
      } */
      if((e.clientX - e.target.clientWidth >= 0) &&
         (window.innerWidth - e.target.clientWidth >= e.clientX)) {
        el.style.left = (e.clientX - el.clientWidth) + 'px';
        el.style.right = 'auto';
      }
      if((e.clientY - e.target.clientHeight >= 0) &&
         (window.innerHeight - e.target.clientHeight >= e.clientY)) {
        el.style.top = (e.clientY - el.clientHeight) + 'px';
        el.style.bottom = 'auto';
      }

      e.preventDefault();
      return false;
    },

    _dragEnd: function (event) {
      var el = event.target.children[0];
      el.style.opacity = '1';

      el.removeEventListener('drag', this._drag);
      el.removeEventListener('dragstart', this._dragStart);

      event.preventDefault();
      return false;
    },

    _handleDrag: function (event) {
      var el = event.target.children[0];
      el.style.opacity = '0.5';

      var img = document.createElement('img');
      event.dataTransfer.setDragImage(img, 0, 0);
    },

    _touchEnd: function (el) {
      el.addEventListener('touchend', function (e) {
        el.style.opacity = '1';
      }, { passive: true });
    },

    _handleTouch: function (e) {
      var touch = e.targetTouches[0];
      var el = e.target.parentNode.parentNode;

      el.style.opacity = '0.5';
      if((touch.clientX - touch.target.clientWidth >= 0) &&
         (window.innerWidth - touch.target.clientWidth >= touch.clientX)) {
        el.style.left = (touch.clientX - el.clientWidth) + 'px';
        el.style.right = 'auto';
      }
      if((touch.clientY - touch.target.clientHeight >= 0) &&
         (window.innerHeight - touch.target.clientHeight >= touch.clientY)) {
        el.style.top = (touch.clientY - el.clientHeight) + 'px';
        el.style.bottom = 'auto';
      }

      this._setQuadrantClass(el, touch.clientX, touch.clientY);

      this._touchEnd(el);
      e.preventDefault();
      return false;
    },

    _setQuadrantClass: function (el, x, y) {
      if (x < (window.innerWidth / 2)) {
        el.classList.remove('right');
        el.classList.add('left');
      } else {
        el.classList.remove('left');
        el.classList.add('right');
      }

      if (y < (window.innerHeight / 2)) {
        el.classList.remove('bottom');
        el.classList.add('top');
      } else {
        el.classList.remove('top');
        el.classList.add('bottom');
      }
    }
  });

</script>
